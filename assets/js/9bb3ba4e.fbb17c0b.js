"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[6961],{75906:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>o});var r=n(13274),a=n(79779);const i={slug:"java-upload-zip",title:"java\u9632\u5fa1zip\u538b\u7f29\u5305\u70b8\u5f39",date:new Date("2023-03-15T00:00:00.000Z"),authors:"yuchengee",tags:["java","\u5b89\u5168","\u4e0a\u4f20","\u6587\u4ef6","zip"]},l=void 0,s={permalink:"/blog/java-upload-zip",editUrl:"https://github.com/yuchengee/blog/edit/master/blog/2023/03-15-java\u9632\u5fa1zip\u538b\u7f29\u5305\u70b8\u5f39.md",source:"@site/blog/2023/03-15-java\u9632\u5fa1zip\u538b\u7f29\u5305\u70b8\u5f39.md",title:"java\u9632\u5fa1zip\u538b\u7f29\u5305\u70b8\u5f39",description:"java\u9632\u5fa1zip\u538b\u7f29\u5305\u70b8\u5f39",date:"2023-03-15T00:00:00.000Z",formattedDate:"2023\u5e743\u670815\u65e5",tags:[{label:"java",permalink:"/blog/tags/java"},{label:"\u5b89\u5168",permalink:"/blog/tags/\u5b89\u5168"},{label:"\u4e0a\u4f20",permalink:"/blog/tags/\u4e0a\u4f20"},{label:"\u6587\u4ef6",permalink:"/blog/tags/\u6587\u4ef6"},{label:"zip",permalink:"/blog/tags/zip"}],readingTime:1.7766666666666666,hasTruncateMarker:!0,authors:[{name:"yuchengee",title:"\u5e9f\u54c1\u5de5\u7a0b\u5e08",url:"https://github.com/yuchengee",imageURL:"/img/logo.png",key:"yuchengee"}],frontMatter:{slug:"java-upload-zip",title:"java\u9632\u5fa1zip\u538b\u7f29\u5305\u70b8\u5f39",date:"2023-03-15T00:00:00.000Z",authors:"yuchengee",tags:["java","\u5b89\u5168","\u4e0a\u4f20","\u6587\u4ef6","zip"]},unlisted:!1,prevItem:{title:"java\u8c03\u7528chatgpt",permalink:"/blog/java-request-chatgpt"},nextItem:{title:"kafka\u5b89\u88c5\u4e0e\u7b80\u5355\u4f7f\u7528",permalink:"/blog/kafka-useage"}},p={authorsImageUrls:[void 0]},o=[];function c(e){const t={a:"a",code:"code",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.p,{children:"java\u9632\u5fa1zip\u538b\u7f29\u5305\u70b8\u5f39"}),"\n",(0,r.jsxs)(t.p,{children:["\u200b\t\u53c2\u8003 ",(0,r.jsx)(t.a,{href:"https://www.cnblogs.com/lnlvinso/p/11838904.html",children:"https://www.cnblogs.com/lnlvinso/p/11838904.html"})]}),"\n",(0,r.jsxs)(t.p,{children:["\u200b\t\t\t",(0,r.jsx)(t.a,{href:"https://blog.csdn.net/j2IaYU7Y/article/details/82321082",children:"https://blog.csdn.net/j2IaYU7Y/article/details/82321082"})]}),"\n",(0,r.jsx)(t.p,{children:"\u200b\t\u538b\u7f29\u5305\u70b8\u5f39\u82f1\u6587\u4e3aArc.Bomb\uff0c\u662f\u4e00\u6b3e\u538b\u7f29\u5305\u75c5\u6bd2\u3002\u5b83\u901a\u5e38\u53ea\u6709\u51e0\u767eKB\uff0c\u4f46\u662f\u89e3\u538b\u540e\u4f1a\u53d8\u6210\u4e0a\u767eMB\u7684\u5e9e\u7136\u5927\u7269\u3002\u5b83\u80fd\u52ab\u6301\u7f51\u94f6\u652f\u4ed8\u94fe\u63a5\uff0c\u628a\u7f51\u8d2d\u4ea4\u6613\u8d44\u91d1\u52ab\u6301\u5230\u9ed1\u5ba2\u8d26\u6237\u3002\u5b83\u80fd\u591f\u5229\u7528\u7279\u6b8a\u7684\u6280\u672f\u9003\u8fc7\u6740\u6bd2\u8f6f\u4ef6\u7684\u4e91\u67e5\u6740\u7cfb\u7edf\u3002"}),"\n",(0,r.jsx)(t.p,{children:"\u200b\t\u4e00\u822c\u6765\u8bf4\uff0c\u538b\u7f29\u6587\u4ef6\u7684\u538b\u7f29\u6bd4\uff0c\u5c31\u662f\u538b\u7f29\u6587\u4ef6\u5927\u5c0f\u548c\u89e3\u538b\u7f29\u4e4b\u540e\u6587\u4ef6\u5927\u5c0f\u7684\u6bd4\u4f8b\uff0c\u8d85\u8fc720\u500d\uff0c\u4e00\u4e9b\u6740\u6bd2\u5373\u62a5\u544a\u4e3a\u538b\u7f29\u5305\u70b8\u5f39\uff0c\u6216\u8005\u53eb\u89e3\u538b\u7f29\u70b8\u5f39\u3002"}),"\n",(0,r.jsx)(t.p,{children:"\u200b\tJava\u5f00\u53d1\u4e2d\u7ecf\u5e38\u9047\u5230\u4e0a\u4f20\u6587\u4ef6\u7684\u573a\u666f\uff0c\u6709\u65f6\u5019\u9700\u8981\u4e0a\u4f20\u538b\u7f29\u5305\u6587\u4ef6\uff0c\u5c31\u6709\u53ef\u80fd\u51fa\u73b0\u538b\u7f29\u5305\u70b8\u5f39\u653b\u51fb\u7684\u5b89\u5168\u95ee\u9898\uff0c\u9700\u8981\u505a\u4e00\u4e9b\u9632\u5fa1\u63aa\u65bd\u3002"}),"\n",(0,r.jsx)(t.p,{children:"\u200b\t\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u9700\u8981\u7ed3\u5408\u81ea\u5df1\u7684\u4e1a\u52a1\u8fdb\u884c\u5224\u5b9a\u662f\u5426\u5728zip\u70b8\u5f39\u3002\u4e0b\u9762\u7ed9\u51fa\u4e00\u4e2a\u793a\u4f8b\uff1a"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"\u5355\u4e2aEntry\u8d85\u8fc72G"}),"\n",(0,r.jsx)(t.li,{children:"\u5355\u4e2aEntry\u538b\u7f29\u7387\u8d85\u8fc7200"}),"\n",(0,r.jsx)(t.li,{children:"\u603bEntry\u8d85\u8fc71000\u4e2a (\u8fd9\u4e2a\u9700\u8981\u7ed3\u5408\u4e1a\u52a1\uff0c\u4e00\u822c\u6bcf\u4e2a\u538b\u7f29\u5305\u6700\u5927\u4e0d\u8d85\u8fc7\u591a\u5c11\u3002\u5982\u679c\u662f\u5730\u56fe\u8fd9\u79cd\uff0centry\u603b\u6570\u5f88\u591a\u7684\u8bdd\uff0c\u7a0b\u5e8f\u9700\u8981\u82b1\u5f88\u957f\u65f6\u95f4)"}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:'private static final long MAX_ENTRY_SIZE = 2 * 1024 * 1024 * 1024L;\n\npublic static boolean isZipBomb(MultipartFile file) {\n        byte[] buffer = new byte[8 * 1024 * 1024];\n        int numOfEntry = 0;\n        try (ZipInputStream zipInputStream = new ZipInputStream(file.getInputStream(), Charset.forName("gbk"))) {\n            ZipEntry zipEntry;\n            while ((zipEntry = zipInputStream.getNextEntry()) != null) {\n                long size = zipEntry.getSize();\n                if (size > MAX_ENTRY_SIZE) return true;\n                long compressedSize = zipEntry.getCompressedSize();\n                // ZipEntry\u7684size\u53ef\u80fd\u4e3a-1\uff0c\u8868\u793a\u672a\u77e5\n                if (size == -1) {\n                    int len;\n                    while ((len = zipInputStream.read(buffer, 0, buffer.length)) != -1) {\n                        size += len;\n                    }\n                }\n                if (compressedSize != 0 && size / compressedSize > 200) return true;\n                numOfEntry++;\n                if (numOfEntry > 1000) return true;\n                zipInputStream.closeEntry();\n            }\n        } catch (IOException e) { log.error(e.getMessage(), e); }\n        return false;\n}\n\n'})}),"\n",(0,r.jsx)(t.p,{children:"\u200b"}),"\n",(0,r.jsx)(t.p,{children:"\u200b\t\u4e5f\u53ef\u4ee5\u8ba1\u7b97\u603b\u7684entry size\uff0c\u4e5f\u5c31\u662f\u89e3\u538b\u540e\u7684\u5927\u5c0f\uff0c\u548c\u538b\u7f29\u5305\u7684\u5927\u5c0f\u7684\u6bd4\u7387\u3002\u8fd9\u6837\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u5982\u679c\u5728\u4e00\u5806\u6b63\u5e38\u7684\u6587\u4ef6\u4e2d\u5939\u6742\u4e00\u4e9b\u6709\u95ee\u9898\u7684entry\uff0c\u53ef\u80fd\u5c31\u8bc6\u522b\u4e0d\u51fa\u6765\u3002"}),"\n",(0,r.jsxs)(t.p,{children:["\u200b\t",(0,r.jsx)(t.code,{children:"Sum(entry.size) / zipFile.size > MAX"})]}),"\n",(0,r.jsxs)(t.p,{children:["\u200b\t\u5404\u79cd\u6587\u4ef6\u7684\u6587\u4ef6\u5934\u6807\u5fd7\uff1a",(0,r.jsx)(t.a,{href:"https://blog.csdn.net/rrrfff/article/details/7484109",children:"https://blog.csdn.net/rrrfff/article/details/7484109"})]})]})}function u(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},79779:(e,t,n)=>{n.d(t,{R:()=>l,x:()=>s});var r=n(79474);const a={},i=r.createContext(a);function l(e){const t=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),r.createElement(i.Provider,{value:t},e.children)}}}]);