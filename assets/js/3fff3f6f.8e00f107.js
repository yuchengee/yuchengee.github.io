"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[8071],{2446:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>p,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>o});var a=n(13274),r=n(79779);const s={slug:"java-request-chatgpt",title:"java\u8c03\u7528chatgpt",date:new Date("2023-04-07T00:00:00.000Z"),authors:"yuchengee",tags:["java","chatgpt","http"]},p=void 0,i={permalink:"/blog/java-request-chatgpt",editUrl:"https://github.com/yuchengee/blog/edit/master/blog/2023/04-07-java\u8c03\u7528chatgpt.md",source:"@site/blog/2023/04-07-java\u8c03\u7528chatgpt.md",title:"java\u8c03\u7528chatgpt",description:"java\u8c03\u7528chatgpt",date:"2023-04-07T00:00:00.000Z",formattedDate:"2023\u5e744\u67087\u65e5",tags:[{label:"java",permalink:"/blog/tags/java"},{label:"chatgpt",permalink:"/blog/tags/chatgpt"},{label:"http",permalink:"/blog/tags/http"}],readingTime:1.2133333333333334,hasTruncateMarker:!0,authors:[{name:"yuchengee",title:"\u5e9f\u54c1\u5de5\u7a0b\u5e08",url:"https://github.com/yuchengee",imageURL:"/img/logo.png",key:"yuchengee"}],frontMatter:{slug:"java-request-chatgpt",title:"java\u8c03\u7528chatgpt",date:"2023-04-07T00:00:00.000Z",authors:"yuchengee",tags:["java","chatgpt","http"]},unlisted:!1,prevItem:{title:"junit\u6d4b\u8bd5\u63a5\u53e3",permalink:"/blog/junit-springboot"},nextItem:{title:"java\u9632\u5fa1zip\u538b\u7f29\u5305\u70b8\u5f39",permalink:"/blog/java-upload-zip"}},c={authorsImageUrls:[void 0]},o=[{value:"\u4f9d\u8d56",id:"\u4f9d\u8d56",level:3},{value:"\u4ee3\u7801",id:"\u4ee3\u7801",level:3}];function l(e){const t={a:"a",code:"code",h3:"h3",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.p,{children:"java\u8c03\u7528chatgpt"}),"\n",(0,a.jsxs)(t.p,{children:["\u53c2\u8003 ",(0,a.jsx)(t.a,{href:"https://blog.csdn.net/m0_51545690/article/details/129739621",children:"https://blog.csdn.net/m0_51545690/article/details/129739621"})]}),"\n",(0,a.jsx)(t.p,{children:"apiKey\u9700\u8981\u6ce8\u518c\u8d26\u53f7\uff0c\u7136\u540e\u81ea\u5df1\u751f\u6210\u3002"}),"\n",(0,a.jsx)(t.h3,{id:"\u4f9d\u8d56",children:"\u4f9d\u8d56"}),"\n",(0,a.jsx)(t.p,{children:"\u4f7f\u7528hutool\u53d1\u9001http\u8bf7\u6c42"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"<dependency>\n\t<groupId>cn.hutool</groupId>\n\t<artifactId>hutool-all</artifactId>\n\t<version>5.8.16</version>\n</dependency>\n"})}),"\n",(0,a.jsx)(t.h3,{id:"\u4ee3\u7801",children:"\u4ee3\u7801"}),"\n",(0,a.jsx)(t.p,{children:"ChatGptMessage"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"@Getter\n@Setter\n@AllArgsConstructor\npublic class ChatGptMessage {\n    private String role;\n    private String content;\n}\n"})}),"\n",(0,a.jsx)(t.p,{children:"ChatGptRequestParameter"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:'@Getter\n@Setter\n@NoArgsConstructor\n@AllArgsConstructor\npublic class ChatGptRequestParameter {\n    private String model = "gpt-3.5-turbo";\n    private List<ChatGptMessage> messages = new ArrayList<>();\n\n    public void addMessage(ChatGptMessage chatGptMessage) {\n        messages.add(chatGptMessage);\n    }\n}\n'})}),"\n",(0,a.jsx)(t.p,{children:"ChatGptResponseParameter"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"@Getter\n@Setter\n@AllArgsConstructor\npublic class ChatGptResponseParameter {\n    private String id;\n    private String object;\n    private String created;\n    private String model;\n    private Usage usage;\n    private List<Choices> choices;\n}\n"})}),"\n",(0,a.jsx)(t.p,{children:"Choices"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"@Getter\n@Setter\n@AllArgsConstructor\npublic class Choices {\n    private ChatGptMessage message;\n    private String finish_reason;\n    private Integer index;\n}\n"})}),"\n",(0,a.jsx)(t.p,{children:"Usage"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"@Getter\n@Setter\n@AllArgsConstructor\npublic class Usage {\n    private String prompt_tokens;\n    private String completion_tokens;\n    private String total_tokens;\n}\n"})}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:'@Service\npublic class CustomChatGpt {\n    @Autowired\n    private ObjectMapper objectMapper; // \u521b\u5efa\u4e00\u4e2aObjectMapper\uff0c\u7528\u4e8e\u89e3\u6790\u548c\u521b\u5efajson\n    // \u4f7f\u7528\u7684\u6a21\u578b\n    private String model = "gpt-3.5-turbo-0301";\n    // \u5bf9\u5e94\u7684\u8bf7\u6c42\u63a5\u53e3\n    private String url = "https://api.openai.com/v1/chat/completions";\n    // \u9ed8\u8ba4\u7f16\u7801\n    private Charset charset = StandardCharsets.UTF_8;\n\n    // \u521b\u5efa\u4e00\u4e2aChatGptRequestParameter\uff0c\u7528\u4e8e\u643a\u5e26\u8bf7\u6c42\u53c2\u6570\n    private ChatGptRequestParameter chatGptRequestParameter = new ChatGptRequestParameter();\n\n    public String hutoolHttp(String apiKey, String question) {\n        // \u8bbe\u7f6e\u8bf7\u6c42\u53c2\u6570\n        chatGptRequestParameter.addMessage(new ChatGptMessage("user", question));\n\n        try {\n            // Proxy proxy = new Proxy(Proxy.Type.HTTP, new InetSocketAddress("", 80));\n            String resStr = cn.hutool.http.HttpRequest.post(url)\n            //       .setProxy(proxy)\n                    .header(HttpHeaders.CONTENT_TYPE, "application/json")\n                    .header(HttpHeaders.AUTHORIZATION, "Bearer " + apiKey)\n                    .body(objectMapper.writeValueAsString(chatGptRequestParameter))\n                    .execute().body();\n            ChatGptResponseParameter responseParameter = objectMapper.readValue(resStr, ChatGptResponseParameter.class);\n            String ans = "";\n            // \u904d\u5386\u6240\u6709\u7684Choices\uff08\u4e00\u822c\u90fd\u53ea\u6709\u4e00\u4e2a\uff09\n            for (Choices choice : responseParameter.getChoices()) {\n                ChatGptMessage message = choice.getMessage();\n                chatGptRequestParameter.addMessage(new ChatGptMessage(message.getRole(), message.getContent()));\n                String s = message.getContent().replaceAll("\\n+", "\\n");\n                ans += s;\n            }\n            // \u8fd4\u56de\u4fe1\u606f\n            return ans;\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        // \u53d1\u751f\u5f02\u5e38\uff0c\u79fb\u9664\u521a\u521a\u6dfb\u52a0\u7684ChatGptMessage\n        chatGptRequestParameter.getMessages().remove(chatGptRequestParameter.getMessages().size() - 1);\n        return "\u60a8\u5f53\u524d\u7684\u7f51\u7edc\u65e0\u6cd5\u8bbf\u95ee";\n    }\n}\n'})})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},79779:(e,t,n)=>{n.d(t,{R:()=>p,x:()=>i});var a=n(79474);const r={},s=a.createContext(r);function p(e){const t=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:p(e.components),a.createElement(s.Provider,{value:t},e.children)}}}]);